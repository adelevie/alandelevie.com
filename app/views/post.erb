<% content_for(:title) { post.title } %>

<article>
  <%= post_header post %>
  
  <%= post_body post %>

</article>

<hr />

<ol id="comments">
  <% if post.comments.visible.count > 0 %>
    <% post.comments.visible.asc(:created_at).each do |comment| %>
      <li id="comment-<%= comment.id %>"> <!-- id used for anchor -->
        <header>
          <span class="author">
            <% if comment.author_url.present? %>
              <a rel="nofollow" href="<%= h comment.author_url %>">
                <%= h comment.author %>
              </a>
            <% else %>
              <%= h comment.author %>
            <% end %>
          </span>
          <time datetime="<%= long_datetime comment.created_at %>" pubdate>
            <%= comment_time comment.created_at %>
          </time>
        </header>
        
        <%= comment_body comment.body %>
        
      </li>
    <% end %>
  <% end %>
</ol>

<% new_comment = nil unless defined?(new_comment) %>
<section id="comment-form">
  <% if new_comment and new_comment.errors.any? %>
    <p>Comments must have a name and a body.</p>
  <% end %>
  
  <form method="post" action="<%= comment_path post %>#comment-form">
    <input name="comment[author]" type="text" placeholder="name" required 
      <% if new_comment %>value="<%= new_comment.author %>"<% end %>
      />
    <input name="comment[author_url]" type="url" placeholder="website" 
      <% if new_comment %>value="<%= new_comment.author_url %>"<% end %>
      />
    <textarea name="comment[body]" required><% if new_comment %><%= h new_comment.body %><% end %></textarea>
    <input type="submit" value="Post" />
  </form>
</section>