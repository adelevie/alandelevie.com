<% content_for :title do %><%= post.title %><% end %>
<% content_for :description do %><%= meta_description post %><% end %>

<% content_for :sidebar_left do %>
  <a href="/">&laquo; everything else</a>
  
  <h1>
    blog by <cite><a href="mailto:kprojection@gmail.com">Eric Mill</a></cite>
  </h1>
  <h2>
    also <a rel="me" href="http://twitter.com/klondike">twitter</a>
  </h2>
<% end %>

<article>
  <header>
    <h1>
      <% if post.display_title %>
        <a href="<%= post_path post %>">
          <%= h post.title %>
        </a>
      <% else %>
        <a>
          <%= h post.title %>
        </a>
      <% end %>
    </h1>
  </header>
  
  <%= post_body post %>
  
  <footer>
    <% if post.visible? %>
      <time datetime="<%= short_datetime post.published_at %>" pubdate><%= long_date post.published_at %></time>
    <% else %>
      <time datetime="<%= short_datetime post.updated_at%>">Unpublished, last updated <%= long_date post.updated_at %></time>
    <% end %>
    <hr />
  </footer>
</article>

<ol id="comments">
  <% if post.comments.visible.count > 0 %>
    <% post.comments.visible.asc(:created_at).each do |comment| %>
      <li id="comment-<%= comment.id %>"> <!-- id used for anchor -->
        <header>
          <cite>
            <% if comment.author_url.present? %>
              <a rel="nofollow" href="<%= h comment.author_url %>">
                <%= h comment.author %>
              </a>
            <% else %>
              <%= h comment.author %>
            <% end %>
          </cite>
          <time datetime="<%= long_datetime comment.created_at %>" pubdate>
            <%= comment_time comment.created_at %>
          </time>
        </header>
        
        <%= comment_body comment.body %>
        
      </li>
    <% end %>
  <% end %>
</ol>

<% new_comment = nil unless defined?(new_comment) %>
<section id="comment-form">
  <% if new_comment and new_comment.errors.any? %>
    <p>Comments must have a name and a body.</p>
  <% end %>
  
  <form method="post" action="<%= comment_path post %>#comment-form">
    <input name="comment[author]" type="text" placeholder="name" required 
      <% if new_comment %>value="<%= new_comment.author %>"<% end %>
      />
    <input name="comment[author_url]" type="url" placeholder="website" 
      <% if new_comment %>value="<%= new_comment.author_url %>"<% end %>
      />
    <textarea name="comment[body]" required><% if new_comment %><%= h new_comment.body %><% end %></textarea>
    <input type="submit" value="Post" />
  </form>
</section>